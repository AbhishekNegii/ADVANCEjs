<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Expense Tracker</title>
</head>
<body>
    <form method="post" onsubmit="saveToLocalStorage(event)">
        <h1>Expense Tracker</h1>
        Choose Expense Amount: <input type="text" id="amount">
        <br>
        Choose Description : <input type="text" id="desc">
        
        <br>
        <label for="category">Category: </label>
        <select id="category">
            <option value="fuel">Fuel</option>
            <option value="food">Food</option>
            <option value="electricity">Electricity</option>
            <option value="movie">Movie</option>
        </select>
        <br>
        <button id="btn">Add Expense</button>
        <br>

    </form>
    <ul id="listOfUsers"></ul>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.27.2/axios.min.js"></script>
    <script>
        function saveToLocalStorage(event)
        {
            event.preventDefault();
             const amount = event.target.amount.value;
             const desc = event.target.desc.value;
             const category = event.target.category.value;
            const obj =
            {
              amount,
              desc,
              category
            } 
            axios.post("https://crudcrud.com/api/7662aef362f742ea8d3da34795a7782f/expenseTracker",obj)
            .then((response)=>{
                showNewUserOnScreen(response.data);
                console.log(response)
            })
            .catch((err)=>{
                console.log(err)
            })
        } 
        window.addEventListener("DOMContentLoaded", () => {

            axios.get("https://crudcrud.com/api/7662aef362f742ea8d3da34795a7782f/expenseTracker")
            .then((response)=>{
                    for(var i=0;i<response.data.length;i++){
                    showNewUserOnScreen(response.data[i]);
                }
                            
            })
        })
        function showNewUserOnScreen(user)
        {
            document.getElementById('amount').value = "";
            document.getElementById('category').value = "";
            document.getElementById('desc').value = "";


            const parentNode = document.getElementById('listOfUsers');
            const childHTML = `<li id=${user.desc}> ${user.amount} - ${user.category} - ${user.desc}
            <button onclick=deleteUser('${user._id}')> Delete User </button>
            <button onclick=editUserDetails('${user.email}','${user.amount}','${user.desc}','${user._id}')>Edit User </button>
            </li>`;


            parentNode.innerHTML = parentNode.innerHTML + childHTML;
        }


        function editUserDetails(category, amount, desc,userId){

            document.getElementById('category').value = category; 
            document.getElementById('amount').value = amount;
            document.getElementById('desc').value =desc;


            deleteUser(userId)
            }



        function deleteUser(userId){
            console.log(userId)
            axios.delete(`https://crudcrud.com/api/7662aef362f742ea8d3da34795a7782f/expenseTracker/${userId}`)
            .then((response)=>{
                removeUserFromScreen(userId)
            })
            .catch((err)=>{
                console.log(err);
            })
        

        }

        function removeUserFromScreen(userId){
            const parentNode = document.getElementById('listOfUsers');
            const childNodeToBeDeleted = document.getElementById(userId);
            if(childNodeToBeDeleted) {
                parentNode.removeChild(childNodeToBeDeleted)
            }
        } 
    </script>
    
    
</body>
</html>